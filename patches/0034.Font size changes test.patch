From 638cac9e6a9ada394a7bd3ceb0b979cb52c0546c Mon Sep 17 00:00:00 2001
From: Lichtenshtein <altruumann@protonmail.com>
Date: Sun, 12 Dec 2025 03:08:26 +0300
Subject: [PATCH] Font size changes test

---
diff --git i/src/spek-spectrogram.cc w/src/spek-spectrogram.cc
index de16951..82cc286 100644
--- i/src/spek-spectrogram.cc
+++ w/src/spek-spectrogram.cc
@@ -263,25 +263,33 @@ void SpekSpectrogram::render(wxDC& dc)
     dc.SetPen(*wxWHITE_PEN);
     dc.SetBrush(*wxTRANSPARENT_BRUSH);
     dc.SetTextForeground(wxColour(255, 255, 255));
+
+    // Create and scale base font
     wxFont normal_font;
     if (!wxFromString("Iosevka Term SS08", &normal_font)) {
         normal_font = wxFont(
-        (int)lround(9 * spek_platform_font_scale()),
-        wxFONTFAMILY_SWISS,
-        wxFONTSTYLE_NORMAL,
-        wxFONTWEIGHT_NORMAL);
+            (int)lround(9 * spek_platform_font_scale()),
+            wxFONTFAMILY_SWISS,
+            wxFONTSTYLE_NORMAL,
+            wxFONTWEIGHT_NORMAL
+        );
     }
-    wxFont large_font = wxFont(normal_font);
+
+    // Create derived fonts
+    wxFont large_font(normal_font);
     large_font.SetPointSize((int)lround(10 * spek_platform_font_scale()));
     large_font.SetWeight(wxFONTWEIGHT_BOLD);
-    wxFont small_font = wxFont(normal_font);
+
+    wxFont small_font(normal_font);
     small_font.SetPointSize((int)lround(8 * spek_platform_font_scale()));
+
+    // Cache font heights by setting font once per size
     dc.SetFont(normal_font);
-    int normal_height = dc.GetTextExtent("dummy").GetHeight();
+    int normal_height = dc.GetCharHeight(); // More direct than GetTextExtent
     dc.SetFont(large_font);
-    int large_height = dc.GetTextExtent("dummy").GetHeight();
+    int large_height = dc.GetCharHeight();
     dc.SetFont(small_font);
-    int small_height = dc.GetTextExtent("dummy").GetHeight();
+    int small_height = dc.GetCharHeight();
 
     // Clean the background.
     dc.Clear();
